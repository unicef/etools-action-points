<!--import [polymer/polymer-element, etools-ajax, lodash]-->
<!--import [static-data-mixin, permission-controller, user-controller, user-data]-->

<dom-module id="static-data">
    <template>
        <user-data></user-data>
    </template>

    <script>

        let dataLoaded = {};
        class StaticData extends APDMixins.StaticDataMixin(APDMixins.PermissionController(APDMixins.UserController(Polymer.Element))) {
            static get is() { return 'static-data'; }

            ready() {
                super.ready();
                this.shadowRoot.querySelector('user-data').addEventListener('user-profile-loaded', () => {
                    this.loadStaticData();
                })
            }

            loadStaticData() {
                this._allDataLoaded();
            }
            _allDataLoaded() {
                this.dispatchEvent(new CustomEvent('static-data-loaded'));
            }

            _triggerGlobalEvent(eventName, data) {
                let detail = {detail: data};
                let event = new CustomEvent(eventName, detail);
                document.dispatchEvent(event);
            }

            _responseError(message, type, eventType = 'error') {
                console[eventType](`Can not load initial data: ${message || '?'}. Reason: ${type || '?'}`);
            }
        }

        window.customElements.define(StaticData.is, StaticData);
    </script>
</dom-module>
