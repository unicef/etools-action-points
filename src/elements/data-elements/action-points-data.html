<!--import [polymer/polymer-element, etools-ajax]-->
<!--import [etools-app-config]-->

<dom-module id="action-points-data">
    <template>
        <etools-ajax
                endpoint="[[endpoint]]"
                on-success="_actionPointsLoaded"
                on-fail="_responseError">
        </etools-ajax>
    </template>

    <script>
        class ActionPointsData extends APDMixins.AppConfig(APDMixins.QueryParamsMixin(Polymer.Element)) {
            static get is() {
                return 'action-points-data';
            }

            static get properties() {
                return {
                    actionPoints: {
                        type: Array,
                        notify: true
                    },
                    requestQueries: {
                        type: Object
                    },
                    listLength: {
                        type: Number,
                        notify: true
                    },
                };
            }

            connectedCallback() {
                super.connectedCallback();
                this.addEventListener('request-action-points', () => this._loadList())
            }

            _loadList() {
                this.dispatchEvent(new CustomEvent('global-loading', {
                    detail: {
                        type: 'action-points-list',
                        active: true,
                        message: 'Loading of action points list...',
                    },
                    bubbles: true,
                    composed: true
                }));
                this.endpoint = this.getEndpoint('actionPointsList');
                this.endpoint.url += this.getQueriesString();
            }

            _actionPointsLoaded(e, detail) {
                if (!detail || !detail.results || detail.count === undefined) {
                    this._responseError(e, detail);
                    return;
                }

                this.actionPoints = detail.results;
                this.listLength = detail.count;

                this.dispatchEvent(new CustomEvent('global-loading', {
                    detail: {type: 'action-points-list'},
                    bubbles: true,
                    composed: true
                }));
            }
        }

        customElements.define(ActionPointsData.is, ActionPointsData);
    </script>
</dom-module>
