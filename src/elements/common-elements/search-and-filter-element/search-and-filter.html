<!--import [polymer/polymer-element, paper-input, paper-card, iron-icon, iron-icons, etools-dropdown, paper-menu-button,
            paper-button, paper-listbox, iron-flex-layout, paper-toggle-button, etools-datepicker/etools-datepicker-button]-->

<!--import [shared-styles, module-styles, tab-inputs-styles, query-params-mixin, date-mixin]-->

<dom-module id="search-and-filter">
    <template>
        <style include="shared-styles module-styles tab-inputs-styles iron-flex"></style>
         <!--inject styles './search-and-filter.scss'-->
        <div class="layout horizontal flex inputs-container">
            <div class="layout horizontal">
                <paper-input
                        type="search"
                        value="{{searchString}}"
                        label="[[searchLabel]]"
                        placeholder="Search"
                        on-value-changed="searchKeyDown"
                        always-float-label
                        inline>

                    <iron-icon icon="search" slot="prefix"></iron-icon>
                </paper-input>
            </div>

            <!-- FILTERS -->
            <template is="dom-repeat" items="[[usedFilters]]">

                <template is="dom-if" if="[[item.isDatePicker]]">
                    <div class="layout horizontal">
                        <paper-input
                                placeholder="Select [[item.name]]"
                                data-selector$="[[item.query]]"
                                on-tap="openDatePicker">
                            <etools-datepicker-button
                                    id="[[item.query]]"
                                    slot="prefix"
                                    format="YYYY-MM-DD"
                                    fire-date-has-changed="[[!restoreInProcess]]"
                                    on-date-has-changed="_changeFilterValue"
                                    show-clear-btn
                                    data-is-datepicker
                                    no-init>
                            </etools-datepicker-button>
                        </paper-input>

                        <div class="filter-reset-button" on-click="removeFilter">×</div>
                    </div>
                </template>


                <template is="dom-if" if="[[!item.isDatePicker]]">
                    <div class="layout horizontal">
                        <etools-dropdown
                                id="[[item.query]]"
                                class="filter-dropdown"
                                selected="[[item.value]]"
                                label="[[item.label]]"
                                placeholder$="Select [[item.name]]"
                                options="[[item.selection]]"
                                option-label="[[item.optionLabel]]"
                                option-value="[[item.optionValue]]"
                                on-iron-select="_changeFilterValue"
                                hide-search="[[item.hideSearch]]"
                                allow-outside-scroll
                                shown-items-limit="5">
                        </etools-dropdown>

                        <div class="filter-reset-button" on-click="removeFilter">×</div>
                    </div>
                </template>

            </template>
        </div>

        <!-- ADD FILTERS -->
        <template is="dom-if" if="[[filters.length]]">
            <div id="add-filter-container">
                <paper-menu-button horizontal-align="right" vertical-align="top" no-overlap>
                    <paper-button slot="dropdown-trigger">
                        <iron-icon icon="filter-list" class="filter-list-icon"></iron-icon>

                        <span class="add-filter-text">ADD FILTER</span>
                    </paper-button>

                    <paper-listbox slot="dropdown-content">
                        <template is="dom-repeat" items="[[availableFilters]]">
                            <paper-item on-click="addFilter"><span class="add-filter--item-name">[[item.name]]</span></paper-item>
                        </template>
                    </paper-listbox>
                </paper-menu-button>
            </div>
        </template>
    </template>

    <!-- inject scripts './search-and-filter.js'-->
</dom-module>
