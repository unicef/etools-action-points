<!--
App global configuration
-->
<!--import [polymer/polymer-element, etools-dexiejs, lodash]-->

<script>
    'use strict';

    window.APDMixins = window.APDMixins || {};
    /**
     * @polymer
     * @mixinFunction
     */
    APDMixins.AppConfig = Polymer.dedupingMixin(baseClass => class extends baseClass {
        constructor() {
            super();

            let etoolsCustomDexieDb = new Dexie('APD');
            etoolsCustomDexieDb.version(1).stores({
                collectionsList: '&name, expire'
            });

            const endpoints = {
                userProfile: {
                    url: '/users/api/profile/'
                },
                changeCountry: {
                    url: '/users/api/changecountry/'
                }
            };

            const localEndpoints = {
                userProfile: {
                    url: '/data/user-profile.json'
                },
                actionPotins: {
                    url: '/data/action-points.json'
                }
            };


            this.baseSite = window.location.origin;
            this.serverBackend = (window.location.port !== '8080');
            this.basePath = this.serverBackend ? '/apd/' : '/';
            this.epsData = this.serverBackend ? endpoints : localEndpoints;
            // dexie js
            this.appDexieDb = etoolsCustomDexieDb;

        }

        getEndpoint(endpointName, data) {
            let endpoint = this.epsData[endpointName];
            if (endpoint && endpoint.hasOwnProperty('template') && endpoint.template !== '') {
                endpoint.url = this.baseSite + _.template(endpoint.template)(data);
            }
            return _.clone(endpoint);
        }

        resetOldUserData() {
            console.log('resetOldUserData()');
            localStorage.removeItem('userId');
            this.appDexieDb.collectionsList.clear();
        }

        getAbsolutePath(path) {
            path = path || '';
            return this.basePath + path;
        }
    });
</script>
