<!--
App global configuration
-->
<!--import [polymer/polymer-element, etools-dexiejs, lodash]-->

<script>
    'use strict';

    window.EtoolsMixins = window.EtoolsMixins || {};
    /**
     * @polymer
     * @mixinFunction
     */
    EtoolsMixins.AppConfig = Polymer.dedupingMixin(baseClass => class extends baseClass {
        constructor() {
            super();

            this.etoolsCustomDexieDb = new Dexie('APD');

            this.etoolsCustomDexieDb.version(1).stores({
                collectionsList: '&name, expire',
            });

            this.endpoints = {
                userProfile: {
                    url: '/users/api/profile/'
                },
                changeCountry: {
                    url: '/users/api/changecountry/'
                }
            };

            this.localEndpoints = {
                userProfile: {
                    url: '/data/user-profile.json'
                },
                actionPotins: {
                    url: '/data/action-points.json'
                }
            };

            this.globals = {
                // globals
                baseSite: window.location.origin,
                basePath: (window.location.port === '8080') ? '/' : '/apd/',
                serverBackend: (window.location.port !== '8080'),
                epsPath: (window.location.port !== '8080') ? 'endpoints' : 'localEndpoints',

                // dexie js
                appDexieDb: this.etoolsCustomDexieDb,
            }
        }

        getEndpoint(endpointName, data) {
            let endpoint = this[this.globals.epsPath][endpointName];
            if (endpoint && endpoint.hasOwnProperty('template') && endpoint.template !== '') {
                endpoint.url = this.baseSite + _.template(endpoint.template)(data);
            }
            return _.clone(endpoint);
        }

        resetOldUserData() {
            console.log('resetOldUserData()');

            localStorage.removeItem('userId');

            this.etoolsCustomDexieDb.collectionsList.clear();
        }

        getAbsolutePath(path) {
            path = path || '';
            return this.globals.basePath + path;
        }
    });
</script>
