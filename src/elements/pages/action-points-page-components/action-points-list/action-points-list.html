<!--import [polymer/polymer-element, etools-behaviors/etools-mixin-factory, polymer/polymer-element,
            pages-header-element, search-and-filter, filters-element, etools-data-table, paper-card, iron-flex-layout,
            static-data-mixin, action-points-data, iron-location, localization-mixin, date-mixin, input-attrs-mixin]-->

<dom-module id="action-points-list">
    <template>
        <!-- inject styles './action-points-list.scss'-->
        <style include="module-styles shared-styles"></style>
        <iron-location path="{{path}}" query="{{query}}"></iron-location>
        <iron-query-params
                params-string="{{query}}"
                params-object="{{queryParams}}">
        </iron-query-params>
        <app-route-converter
                path="{{path}}"
                query-params="{{queryParams}}"
                route="{{route}}">
        </app-route-converter>
        <pages-header-element
                hide-print-button
                link="action-points/new"
                show-add-button="[[!noActionsAllowed(basePermissionPath)]]"
                btn-text="Add Action Point"
                page-title="Action Points">
        </pages-header-element>
        <action-points-data action-points="{{actionPoints}}"
                            request-queries="{{queryParams}}"
                            list-length="{{totalResults}}"></action-points-data>
        <filters-element>
            <search-and-filter search-label="Keywords"
                               id="filters"
                               filters="[[filters]]"
                               query-params="{{queryParams}}"
                               search-params="[[searchParams]]">
            </search-and-filter>
            <div class="show-completed-toggle">
                <span>Show Completed</span>
                <paper-toggle-button checked="{{isShowCompleted}}"></paper-toggle-button>
            </div>
        </filters-element>
        <paper-card>
            <etools-data-table-header id="listHeader"
                                      label="[[visibleRange.0]]-[[visibleRange.1]] of [[totalResults]] results to show">
                <etools-data-table-column class="col-base col-flex-1" field="reference_number" sortable>
                    [[getLabel('reference_number', basePermissionPath)]]
                </etools-data-table-column>
                <etools-data-table-column class="col-base col-flex-2" field="cp_output__name" sortable>
                    [[getLabel('cp_output', basePermissionPath)]]
                </etools-data-table-column>
                <etools-data-table-column class="col-base col-flex-2" field="partner__name" sortable>
                    [[getLabel('partner', basePermissionPath)]]
                </etools-data-table-column>
                <etools-data-table-column class="col-base col-flex-2" field="office" sortable>
                    [[getLabel('office', basePermissionPath)]]
                </etools-data-table-column>
                <etools-data-table-column class="col-base col-flex-2" field="section__name" sortable>
                    [[getLabel('section', basePermissionPath)]]
                </etools-data-table-column>
                <etools-data-table-column class="col-base col-flex-2" field="assigned_to__first_name,assigned_to__last_name" sortable>
                    [[getLabel('assigned_to', basePermissionPath)]]
                </etools-data-table-column>
                <etools-data-table-column class="col-base col-flex-1" field="due_date" sortable>
                    [[getLabel('due_date', basePermissionPath)]]
                </etools-data-table-column>
                <etools-data-table-column class="col-base col-flex-1" field="status" sortable>
                    [[getLabel('status', basePermissionPath)]]
                </etools-data-table-column>
            </etools-data-table-header>

            <template id="rows" is="dom-repeat" items="[[actionPoints]]" as="entry">
                <etools-data-table-row>
                    <div slot="row-data" class="row-action-points">
                        <span  class="col-base col-flex-1">
                            <a class="col-data truncate" href$="[[_getLink(entry.id)]]">[[getStringValue(entry.reference_number)]]</a>
                        </span>
                        <span class="col-data col-base col-flex-2 truncate">[[getStringValue(entry.cp_output.name)]]</span>
                        <span class="col-data col-base col-flex-2 truncate">[[getStringValue(entry.partner.name)]]</span>
                        <span class="col-data col-base col-flex-2 truncate">[[getStringValue(entry.office.name)]]</span>
                        <span class="col-data col-base col-flex-2 truncate">[[getStringValue(entry.section.name)]]</span>
                        <span class="col-data col-base col-flex-2 truncate">[[getStringValue(entry.assigned_to.name)]]</span>
                        <span class="col-data col-base col-flex-1 truncate">[[getStringValue(entry.due_date)]]</span>
                        <span class="col-data col-base col-flex-1 truncate">[[getStringValue(entry.status, statuses, 'display_name')]]</span>
                    </div>
                    <div slot="row-data-details" class="row-action-points">
                        <div class="row-details-content col-flex-1">
                            <span class="rdc-title">Description</span>
                            <span class="truncate">[[getStringValue(entry.description)]]</span>
                        </div>
                        <div class="row-details-content col-flex-1">
                            <span class="rdc-title">PD/SSFA</span>
                            <span class="truncate">[[getStringValue(entry.intervention.number)]]</span>
                        </div>
                        <div class="row-details-content col-flex-1">
                            <span class="rdc-title">Location</span>
                            <span class="truncate">[[getStringValue(entry.location.name)]]</span>
                        </div>
                        <div class="row-details-content col-flex-1">
                            <span class="rdc-title">Module</span>
                            <span class="truncate">[[getStringValue(entry.related_module)]]</span>
                        </div>
                        <div class="row-details-content col-flex-1">
                            <span class="rdc-title">Assigned By</span>
                            <span class="truncate">[[getStringValue(entry.assigned_by.name)]]</span>
                        </div>
                        <div class="row-details-content col-flex-1">
                            <span class="rdc-title">Completed Date</span>
                            <span class="truncate">[[prettyDate(entry.date_of_completion)]]</span>
                        </div>
                    </div>
                </etools-data-table-row>
            </template>

            <etools-data-table-footer
                    page-size="{{pageSize}}"
                    page-number="{{pageNumber}}"
                    total-results="[[totalResults]]"
                    visible-range="{{visibleRange}}"
                    on-page-size-changed="_pageSizeSelected"
                    on-page-number-changed="_pageNumberChanged">
            </etools-data-table-footer>
        </paper-card>
    </template>
    <!-- inject scripts './action-points-list.js' -->
</dom-module>