<!--import [lodash]-->

<script>
    'use strict';

    let _user;
    let _groups;

    window.APDMixins = window.APDMixins || {};
    window.APDMixins.UserController = (superClass) => class extends superClass {
        _setUserData(user) {
            if (_user) { throw 'User already exists!'; }

            if (!user || !_.isObject(user) || _.isArray(user)) { throw 'User must be an object'; }
            if (!user.id || !user.groups) { throw 'User must have id and groups fields!'; }

            _user = _.cloneDeep(user);
            this._setGroups(user);
        }

        _setGroups(user) {
            if (!user.groups.length) { throw 'Can not find user group!'; }
            _groups = user.groups.map((group) => {
                return group.name;
            });
        }

        getUserData() {
            return _.cloneDeep(_user);
        }

        isAuditor() {
            if (!_groups) { throw 'User data is missing or incorrect'; }
            return !!~_groups.indexOf('Auditor');
        }
    }
</script>
